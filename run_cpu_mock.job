#!/bin/bash
#SBATCH --job-name=consensus-mock
#SBATCH --partition=rome
#SBATCH --cpus-per-task=4
#SBATCH --time=00:05:00
#SBATCH --mem=8G
#SBATCH --output=logs/%x-%j.out
set -euo pipefail
cd "$SLURM_SUBMIT_DIR"; mkdir -p logs runs
module purge; module load 2025; module spider Python; module load Python/3.11.6-GCCcore-13.3.0
if [ -f "$HOME/.venvs/consensus/bin/activate" ]; then
  source "$HOME/.venvs/consensus/bin/activate"
else
  python3 -m venv "$HOME/.venvs/consensus"
  source "$HOME/.venvs/consensus/bin/activate"
  python -m pip install -U pip
  pip install -r requirements.txt
fi
export PYTHONPATH="$PWD:$PWD/src:${PYTHONPATH:-}"
srun python -m src.main --mock --scenario tiny_truth
