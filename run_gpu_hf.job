#!/bin/bash
#SBATCH -J consensus_mistral
#SBATCH -o logs/%x-%j.out
#SBATCH -A tesr108469
#SBATCH -p gpu_mig
#SBATCH --gpus=1
#SBATCH --cpus-per-task=9
#SBATCH --mem=60G
#SBATCH -t 00:20:00

module purge
module load 2025
module spider Python
module load Python/3.11.6-GCCcore-13.3.0

source ~/.venvs/consensus/bin/activate

export HF_HOME=/scratch-shared/$USER/hf
export TRANSFORMERS_CACHE=$HF_HOME/transformers
export HF_DATASETS_CACHE=$HF_HOME/datasets
mkdir -p "$HF_HOME" logs runs

SCENARIO="${1:-mistral_math_smoke}"

echo "Scenario: ${SCENARIO}"
srun python -m src.main --scenario "${SCENARIO}" --preset mistral --dtype bfloat16
