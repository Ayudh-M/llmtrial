#!/bin/bash
#SBATCH -J setup_env
#SBATCH -A tesr108469          # <-- your project/account
# no -p line: default partition is 'thin'
#SBATCH --time=00:20:00
#SBATCH --cpus-per-task=4
#SBATCH --mem=8G
#SBATCH -o logs/%x-%j.out

set -euo pipefail
cd "$SLURM_SUBMIT_DIR"

python3 -m venv ~/.venvs/consensus
source ~/.venvs/consensus/bin/activate
python -m pip install -U pip wheel

# deps
pip install -r requirements.txt || true
pip install "transformers>=4.41" "accelerate>=0.30" "jsonschema>=4.21" pyyaml rich
# CPU torch is fine for env setup; GPU wheel will be pulled in the GPU job if needed
pip install torch --index-url https://download.pytorch.org/whl/cpu

echo "Env ready at ~/.venvs/consensus"
